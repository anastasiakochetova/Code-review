name: Assign Random Task

on:
  create:
    branches:
      - '*'

jobs:
  pick-assignment:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Pick and Copy Random Assignment
        run: |
          # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö template —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ scripts
          FILES=(scripts/*_template.py)
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª—ã –Ω–∞–π–¥–µ–Ω—ã
          if [ ${#FILES[@]} -eq 0 ]; then
            echo "‚ùå No template files found in scripts/"
            exit 1
          fi
          
          echo "üìã Found ${#FILES[@]} templates:"
          for f in "${FILES[@]}"; do echo "  - $f"; done
          echo ""
          
          # –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä
          IDX=$((RANDOM % ${#FILES[@]}))
          SELECTED_FILE="${FILES[$IDX]}"
          
          echo "üé≤ Random selection: $SELECTED_FILE"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
          if [ -f "$SELECTED_FILE" ]; then
            cp "$SELECTED_FILE" assignment.py
            echo "‚úì Copied to assignment.py"
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±–æ—Ä–µ
            echo "selected_file=$SELECTED_FILE" >> $GITHUB_ENV
            echo "variant=$(basename $SELECTED_FILE .py)" >> $GITHUB_ENV
          else
            echo "‚ùå File not found: $SELECTED_FILE"
            exit 1
          fi
      
      - name: Display Assignment
        run: |
          echo "=== Assignment Content ===" 
          echo ""
          head -30 assignment.py
          echo ""
          echo "..."
          echo ""
          echo "Selected: ${{ env.selected_file }}"
      
      - name: Commit and Push
        run: |
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"
          
          # –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω/–∏–∑–º–µ–Ω—ë–Ω
          if [ -f "assignment.py" ]; then
            git add assignment.py
            git commit -m "üé≤ Auto-assigned: $(basename ${{ env.selected_file }} .py)" || echo "Nothing to commit"
            git push origin HEAD:${{ github.ref }}
          fi
